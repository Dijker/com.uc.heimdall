<!doctype html>
<html>
    <head>
        <link rel="stylesheet" type="text/css" href="styles.css" />
        <script type="text/javascript" src="/homey.js" data-origin="settings"></script>
        <!-- Line below for development -->
        <!--script src="vue.js" data-origin="settings"></script>
        <!- - line below for production -->
        <script src="vue.min.js" data-origin="settings"></script>
        <!--  -->
        <script type="text/javascript" src="settings.js" data-origin="settings"></script>
    </head>
    <body>
        <div id="app" style="margin-left:15px;margin-right:20px;">
            <h1 data-i18n="settings.title">-Heimdall-</h1>
            <p data-i18n="settings.benefit"></p>

            <table width="100%">
                <tr>
                    <td id="tab1b" class="tab tab-active" onclick="showTab('tab1')" data-i18n="tab1.title">-Dashboard-</td>
                    <td id="tab2b" class="tab tab-inactive" onclick="showTab('tab2')" data-i18n="tab2.title">-Settings-</td>
                    <td id="tab3b" class="tab tab-inactive" onclick="showTab('tab3')" data-i18n="tab3.title">-Instructions-</td>
                    <td class="tab-unused">&nbsp;</td>
                </tr>
            </table>
            <div style="height:8px"></div>
            <div id="tab1">
                <fieldset class="listContainer">
                    <legend data-i18n="tab1.status.title">-Status-</legend>
                    <table>
                        <tr>
                            <td><button id="surveillanceModeFull" class="btn wide btn-inactive" data-i18n="tab1.status.smodeFull">-Full Surveillance mode-</button></td>
                            <td><button id="surveillanceModePartial" class="btn wide btn-inactive" data-i18n="tab1.status.smodePartial">-Partial Surveillance mode-</button></td>
                            <td>&nbsp;</td>
                            <td><button id="alarmMode" class="btn wide btn-inactive" data-i18n="tab1.status.alarm">-Alarm-</td>
                        </tr>
                    </table>
                </fieldset>
                
                <fieldset class="listContainer">
                    <legend data-i18n="tab1.history.title">-History-</legend>
                    <table width=100%>
                        <tr>
                            <td><input type="checkbox" id="show_refresh" onClick="show_log()" checked ><span data-i18n="tab1.history.autoRefresh">-Auto refresh (every 1 Sec)-</span></td>
                        </tr>
                    </table> 
                    <textarea id="logtextarea" style="margin: 0px; width: 98%; height: 700px;"></textarea>
                    <button id="clear_simpleLOG" class="left" onclick="clear_simpleLOG()" data-i18n="tab1.history.btnClearLog">-Clear Log-</button>
                    <button id="download_simpleLOG" class="left" onclick="download_simpleLOG()"  data-i18n="tab1.history.btnDownload">-Download-</button>
                </fieldset>
            </div>
            <div id="tab2" style="display:none">
                <fieldset class="listContainer">
                    <legend data-i18n="tab2.settings.title">-Settings-</legend>
                    <table width="80%">
                        <tr>
                            <td class="rTableCell" data-i18n="tab2.settings.tDelay">-Trigger delay:-</td>
                            <td class="rTableCell">
                                <input id="triggerDelay" type="text" value="31" class="narrow">
                            </td class="rTableCell">
                            <td class="rTableCell" data-i18n="tab2.settings.seconds">-Seconds-</td>
                            <td class="rTableCell">
                                <button id="saveTriggerDelay" class="left" onclick="changeTriggerDelay()" data-i18n="tab2.settings.save">-Save-</button>
                            </td>
                            <td width="2%"></td>
                            <td width="35%" class="rTableCell">
                                <input id="logArmedOnly" type="checkbox" onclick="changeLogArmedOnly()">
                                <span data-i18n="tab2.settings.logarmedonly">-Only log when a Surveillance mode is active-</span></td>
                            <td width="2%"></td>
                            <td width="35%" class="rTableCell">
                                <input id="logTrueOnly" type="checkbox" onclick="changeLogTrueOnly()">
                                <span data-i18n="tab2.settings.logtrueonly">-Do not log deactivating of sensors-</span></td>
                        </tr>
                        <tr>
                            <td class="rTableCell" colspan="4"></td>
                            <td></td>
                            <td class="rTableCell"></td>
                            <td></td>
                            <td class="rTableCell"></td>
                        </tr>
                     </table>

                    <div class="rTable">
                        <div class="rTableRow">
                            <div class="rTableCell rTableHead" data-i18n="tab2.settings.zone">-Zone-</div>
                            <div class="rTableCell rTableHead"></div>
                            <div class="rTableCell rTableHead" data-i18n="tab2.settings.device">-Device-</div>
                            <div class="rTableCell rTableHead" data-i18n="tab2.settings.monitor">-Monitor-</div>
                            <div class="rTableCell rTableHead" data-i18n="tab2.settings.dTrigger">-Delayed Trigger-</div>
                            <div class="rTableCell rTableHead rTableCellLast"></div>
                        </div>
                    
                        <div class="rTableRow" v-for="device in filteredItems" v-if="device.capabilities.alarm_motion || device.capabilities.alarm_contact">
                            <div class="rTableCell">{{device.zone.name}}</div>
                            <div class="rTableCell" align=center>
                                <img :src="device.icon" style="height:30px;width:auto;"/>
                            </div>
                            <div class="rTableCell">
                                {{device.name}}
                            </div>
                            <div class="rTableCell">
                                <a v-if="!isLogged(device)" @click="addLog(device)" class="btn narrow btn-inactive" style="margin:5px;" data-i18n="tab2.settings.log">-Log-</a>
                                <a v-if="isLogged(device)" @click="removeLog(device)" class="btn narrow btn-active" style="margin:5px;" data-i18n="tab2.settings.log">-Log-</a>
                                
                                <a v-if="!isMonitoredFull(device)" @click="addMonitorFull(device)" class="btn middle btn-inactive" style="margin:5px;" data-i18n="tab2.settings.full">-Full-</a>
                                <a v-if="isMonitoredFull(device)" @click="removeMonitorFull(device)" class="btn middle btn-active" style="margin:5px;" data-i18n="tab2.settings.full">-Full-</a>
                                <a v-if="!isMonitoredPartial(device)" @click="addMonitorPartial(device)" class="btn middle btn-inactive" style="margin:5px;" data-i18n="tab2.settings.partial">-Partial-</a>
                                <a v-if="isMonitoredPartial(device)" @click="removeMonitorPartial(device)" class="btn middle btn-active" style="margin:5px;" data-i18n="tab2.settings.partial">-Partial-</a>
                            </div>
                            <div class="rTableCell">
                                <a v-if="!isDelayed(device)" @click="addDelay(device)" class="btn narrow btn-inactive" style="margin:5px;" data-i18n="tab2.settings.no">-No-</a>
                                <a v-if="isDelayed(device)" @click="removeDelay(device)" class="btn narrow btn-active" style="margin:5px;" data-i18n="tab2.settings.yes">-Yes-</a>
                            </div>
                            
                            <div class=rTableCell></div>
                        </div>
                    </div>


                </fieldset>
            </div>
            <div id="tab3" style="display:none">
                <fieldset class="listContainer">
                    <legend data-i18n="tab3.instructions.title">-Instructions-</legend>
                    <div id="instructionsen" style="display:none">
                        To configure Heimdall you have to do the following:<br />
                        <br />
                        <ul>
                            <li><b>Create a Surveillance Mode button</b></li>
                            <ul><li>
                                Click on the <i>add a device</i> icon in your desired zone and select the <i>Mode</i> device from the Heimdall app.<br>
                                You can rename the device, clicking on <i>next</i> will add it to Homey. 
                            </li></ul>
                            <li><b>Select the device(s) you want to monitor</b></li>
                            <ul><li>
                                Go to the settings page and click on the <i>log</i> button if you just want a line in the log when the device state changes.
                                Click on the <i>Full</i> button if you want the device included when the Surveillance mode is set to <i>Armed</i>
                                If you want the device included when the Surveillance mode is set to <i>Partially Armed</i> click the <i>Partial</i> button.
                                It is possible to select both <i>Full</i> and <i>Partial</i> for one device.
                                If you want to have a delay between the triggering of a device and activating the alarm you can 
                                enable a delay by clicking on the <i>no</i> button in the Delayed Trigger column.<br />
                                The delay that is used can be found on the top of the settings page, it is in seconds and ranges from 0-120 seconds.<br />
                            </li></ul>
                            <li><b>Create a flow to enable the Surveillance Mode</li>
                            <ul><li>
                                Heimdall will listen to the selected sensors and will log all state changes. 
                                Only when Heimdall is in Surveillance Mode a trigger on a sensor will lead to an alarm.
                                Go to the Homey Flow page and create a flow to enable the Surveillance Mode by using the <i>Set state</i> 
                                card from the Surveillance Mode button and selecting the desired state in the <i>...then</i> column.
                            </li></ul>
                            <li><b>Create a flow to disable the Surveillance Mode</b></li>
                            <ul><li>
                                To be able to disable the Surveillance Mode with a flow you have to create one and use the <i>Set state</i> 
                                card from the Surveillance Mode button and selecting the <i>Disarmed</i> state in the <i>...then</i> column.
                            </li></ul>
                            <li><b>Create a flow to act on an alarm</b></li>
                            <ul><li>
                                You can decide for yourself what you want Homey to do when the alarm is activated. 
                                Create a flow and use the <i>The alarm is activated.</i> card in the <i>when...</i> column and select your desired actions in the <i>then...</i> column.<br />
                                You can use the tag <i>Reason</i> on the trigger card to inform you which device activated the alarm.
                            </li></ul>
                            <li><b>Create a flow to disable the alarm</b></li>
                            <ul><li>
                                To deactivate the alarm use the <i>Deactivate Alarm</i> card in a flow in the <i>...then</i> column.
                            </li></ul>
                            <li><b>Log other information</b></li>
                            <ul><li>
                                If you like to log more information, for example presence information, 
                                you can use the <i>Send information to Heimdall</i> card in a flow in the <i>...then</i> column.
                            </li></ul>
                        </ul>
                    </div>
                    <div id="instructionsnl" style="display:none">
                        Stel Heimdall op de volgende manier in:<br />
                        <br />
                        <ul>
                            <li><b>Voeg de Surveillance Mode knop toe</b></li>
                            <ul><li>
                                Klik op het <i>voeg een apparaat</i> icoon in de gewenste zone en selecteer het <i>Modus</i> apparaat van de Heimdall app.<br>
                                Je kan het apparaat een andere naam geven, als je op <i>volgend</i> klikt wordt het apparaat toegevoegd aan Homey. 
                            </li></ul>
                            <li><b>Selecteer de apparaten die je wilt controleren</b></li>
                            <ul><li>
                                Go to the settings page and click on the <i>log</i> button if you just want a line in the log when the device state changes.
                                Click on the <i>Full</i> button if you want the device included when the Surveillance mode is set to <i>Armed</i>
                                If you want the device included when the Surveillance mode is set to <i>Partially Armed</i> click the <i>Partial</i> button.
                                It is possible to select both <i>Full</i> and <i>Partial</i> for one device.
                                If you want to have a delay between the triggering of a device and activating the alarm you can 
                                enable a delay by clicking on the <i>no</i> button in the Delayed Trigger column.<br />
                                The delay that is used can be found on the top of the settings page, it is in seconds and ranges from 0-120 seconds.<br />
                            </li></ul>
                            <li><b>Create a flow to enable the Surveillance Mode</li>
                            <ul><li>
                                Heimdall will listen to the selected sensors and will log all state changes. 
                                Only when Heimdall is in Surveillance Mode a trigger on a sensor will lead to an alarm.
                                Go to the Homey Flow page and create a flow to enable the Surveillance Mode by using the <i>Set state</i> 
                                card from the Surveillance Mode button and selecting the desired state in the <i>...then</i> column.
                            </li></ul>
                            <li><b>Create a flow to disable the Surveillance Mode</b></li>
                            <ul><li>
                                To be able to disable the Surveillance Mode with a flow you have to create one and use the <i>Set state</i> 
                                card from the Surveillance Mode button and selecting the <i>Disarmed</i> state in the <i>...then</i> column.
                            </li></ul>
                            <li>Create a flow to act on an alarm</li>
                            <ul><li>
                                You can decide for yourself what you want Homey to do when the alarm is activated. 
                                Create a flow and use the <i>The alarm is activated.</i> card in the <i>when...</i> column and select your desired actions in the <i>then...</i> column.<br />
                                You can use the tag <i>Reason</i> on the trigger card to inform you which device activated the alarm.
                            </li></ul>
                            <li>Create a flow to disable the alarm</li>
                            <ul><li>
                                To deactivate the alarm use the <i>Deactivate Alarm</i> card in a flow in the <i>...then</i> column.
                            </li></ul>
                            <li>Log other information</li>
                            <ul><li>
                                If you like to log more information, for example presence information, 
                                you can use the <i>Send information to Heimdall</i> card in a flow in the <i>...then</i> column.
                            </li></ul>
                        </ul>
                    </div>
                </fieldset>
            </div>
            <div id="hidden" style="display:none">
                <span id="spanSurvActivated" data-i18n="hidden.surveillance.activated"></span>
                <span id="spanSurvDeactivated" data-i18n="hidden.surveillance.deactivated"></span>
                <span id="spanSecondsFail" data-i18n="hidden.settings.secondsFail"></span>
                <span id="spanSaveSucces" data-i18n="hidden.settings.saveSucces"></span>
            </div>
        </div>
    </body>
</html>